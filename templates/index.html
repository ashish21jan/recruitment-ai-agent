<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment AI Agent</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ¤– Recruitment AI Agent</h1>
            <p>AI-Powered Resume Evaluation & Candidate Matching</p>
        </header>

        <div class="content">
            <form id="evaluationForm" action="/evaluate" method="post" enctype="multipart/form-data">
                <!-- Job Description Section -->
                <section class="form-section">
                    <h2>Step 1: Provide Job Description</h2>
                    
                    <!-- Tab Navigation -->
                    <div class="tabs">
                        <button type="button" class="tab-button active" onclick="showTab('paste')">Paste Text</button>
                        <button type="button" class="tab-button" onclick="showTab('upload')">Upload File</button>
                        <button type="button" class="tab-button" onclick="showTab('generate')">Generate with AI</button>
                    </div>

                    <!-- Paste Text Tab -->
                    <div id="paste-tab" class="tab-content active">
                        <label for="jd-text">Job Description Text:</label>
                        <textarea id="jd-text" name="job_description" rows="10" 
                                  placeholder="Paste your job description here..."></textarea>
                    </div>

                    <!-- Upload File Tab -->
                    <div id="upload-tab" class="tab-content">
                        <label for="jd-file">Upload Job Description (PDF or DOCX):</label>
                        <input type="file" id="jd-file" accept=".pdf,.doc,.docx">
                        <button type="button" class="btn btn-secondary" onclick="uploadJD()">Extract Text from File</button>
                        <div id="jd-upload-status" class="status-message"></div>
                    </div>

                    <!-- Generate with AI Tab -->
                    <div id="generate-tab" class="tab-content">
                        <div class="generate-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="job-title">Job Title:</label>
                                    <input type="text" id="job-title" placeholder="e.g., Senior Software Engineer">
                                </div>
                                <div class="form-group">
                                    <label for="years-exp">Years of Experience:</label>
                                    <input type="number" id="years-exp" placeholder="e.g., 5">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="company-name">Company Name:</label>
                                    <input type="text" id="company-name" placeholder="e.g., TechCorp Inc.">
                                </div>
                                <div class="form-group">
                                    <label for="employment-type">Employment Type:</label>
                                    <select id="employment-type">
                                        <option value="Full-time">Full-time</option>
                                        <option value="Part-time">Part-time</option>
                                        <option value="Contract">Contract</option>
                                        <option value="Internship">Internship</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="industry">Industry:</label>
                                    <input type="text" id="industry" placeholder="e.g., Technology, Finance">
                                </div>
                                <div class="form-group">
                                    <label for="location">Location:</label>
                                    <input type="text" id="location" placeholder="e.g., San Francisco, CA">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="skills">Must-Have Skills (comma-separated):</label>
                                <input type="text" id="skills" placeholder="e.g., Python, FastAPI, Machine Learning, AWS">
                            </div>

                            <button type="button" class="btn btn-secondary" onclick="generateJD()">Generate Job Description</button>
                            <div id="jd-generate-status" class="status-message"></div>
                        </div>
                    </div>
                </section>

                <!-- Resume Upload Section -->
                <section class="form-section">
                    <h2>Step 2: Upload Resumes</h2>
                    <label for="resumes">Upload Candidate Resumes (PDF or DOCX, max 10 files):</label>
                    <input type="file" id="resumes" name="resumes" multiple accept=".pdf,.doc,.docx" required>
                    <p class="helper-text">Selected: <span id="file-count">0</span> file(s)</p>
                </section>

                <!-- Submit Button -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Evaluate Candidates</button>
                </div>
            </form>

            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing resumes with AI... This may take a moment.</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // File count tracker
        document.getElementById('resumes').addEventListener('change', function(e) {
            const count = e.target.files.length;
            document.getElementById('file-count').textContent = count;
            
            if (count > 10) {
                alert('Maximum 10 resumes allowed. Please select fewer files.');
                e.target.value = '';
                document.getElementById('file-count').textContent = '0';
            }
        });

        // Upload JD file and extract text
        async function uploadJD() {
            const fileInput = document.getElementById('jd-file');
            const statusDiv = document.getElementById('jd-upload-status');
            
            if (!fileInput.files[0]) {
                statusDiv.innerHTML = '<span class="error">Please select a file first.</span>';
                return;
            }

            const formData = new FormData();
            formData.append('jd_file', fileInput.files[0]);

            statusDiv.innerHTML = '<span class="info">Extracting text...</span>';

            try {
                const response = await fetch('/extract-jd', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to extract job description');
                }

                const data = await response.json();
                document.getElementById('jd-text').value = data.job_description;
                statusDiv.innerHTML = '<span class="success">âœ“ Text extracted successfully!</span>';
                
                // Switch to paste tab to show extracted text
                showTabByName('paste');
            } catch (error) {
                statusDiv.innerHTML = '<span class="error">Error: ' + error.message + '</span>';
            }
        }

        // Generate JD with AI
        async function generateJD() {
            const statusDiv = document.getElementById('jd-generate-status');
            
            const jobTitle = document.getElementById('job-title').value;
            const yearsExp = document.getElementById('years-exp').value;
            const companyName = document.getElementById('company-name').value;
            const employmentType = document.getElementById('employment-type').value;
            const industry = document.getElementById('industry').value;
            const location = document.getElementById('location').value;
            const skills = document.getElementById('skills').value;

            if (!jobTitle || !yearsExp || !companyName || !skills) {
                statusDiv.innerHTML = '<span class="error">Please fill in all required fields.</span>';
                return;
            }

            statusDiv.innerHTML = '<span class="info">Generating job description with AI...</span>';

            try {
                const response = await fetch('/generate-jd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        job_title: jobTitle,
                        years_of_experience: parseInt(yearsExp),
                        must_have_skills: skills,
                        company_name: companyName,
                        employment_type: employmentType,
                        industry: industry,
                        location: location
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate job description');
                }

                const data = await response.json();
                document.getElementById('jd-text').value = data.job_description;
                statusDiv.innerHTML = '<span class="success">âœ“ Job description generated successfully!</span>';
                
                // Switch to paste tab to show generated text
                showTabByName('paste');
            } catch (error) {
                statusDiv.innerHTML = '<span class="error">Error: ' + error.message + '</span>';
            }
        }

        function showTabByName(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelectorAll('.tab-button').forEach((btn, index) => {
                const tabs = ['paste', 'upload', 'generate'];
                if (tabs[index] === tabName) {
                    btn.classList.add('active');
                }
            });
        }

        // Show loading spinner on form submit
        document.getElementById('evaluationForm').addEventListener('submit', function() {
            const jdText = document.getElementById('jd-text').value.trim();
            
            if (!jdText) {
                alert('Please provide a job description before submitting.');
                event.preventDefault();
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.querySelector('.content').style.opacity = '0.5';
        });
    </script>
</body>
</html>


